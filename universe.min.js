function distanceSq(t,i){return(t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y)}function distance(t,i){return Math.sqrt(distanceSq(t,i))}function distanceCylinderSq(t,i,n){var s,e,r=distanceSq(t,i);e=t.x<=i.x?(t.x-i.x+n.x)*(t.x-i.x+n.x):(i.x-t.x+n.x)*(i.x-t.x+n.x);var s=e+(t.y-i.y)*(t.y-i.y);return Math.min(r,s)}function distanceCylinder(t,i,n){return Math.sqrt(distanceCylinderSq(t,i,n))}var SeededRNG=function(){function t(t,i,n){switch(void 0===t&&(t=Date.now()),void 0===i&&(i="xorshift"),void 0===n&&(n="uniform"),this.randomSeedInit=t,this.randomSeed=t,this.type=i,this.type){case"javascript":this._rand=Math.random;break;case"central":this._rand=this.randCentral;break;case"randu":this._rand=this.randU;break;case"clib":this._rand=this.randCLib;break;case"mswin":this._rand=this.randMSWin;break;case"xorshift":this._rand=this.randXorshift;break;case"mersenne":this._rand=this.randMersenne;break;default:this._rand=this.randXorshift}switch(this.distribution=n,this.distribution){case"uniform":this.rand=this._rand;break;case"gaussian":this.rand=this.randNorm;break;default:this.rand=this._rand}this.reset()}return t.prototype.reset=function(t){this.randomSeed=t?t:this.randomSeedInit,this.x=123456789,this.y=362436069,this.z=521288629;for(var i=0;14>i;i++)this.randXorshift();for(this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,this.mt[0]=this.randomSeed>>>0,this.mti=1;this.mti<this.N;this.mti++){var n=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&n)>>>16)<<16)+1812433253*(65535&n)+this.mti,this.mt[this.mti]>>>=0}},t.prototype.randNorm=function(){var t,i,n;do t=2*this._rand()-1,i=2*this._rand()-1,n=t*t+i*i;while(n>=1||0==n);var s=Math.sqrt(-2*Math.log(n)/n);return t*s},t.prototype.randCentral=function(){return this.randomSeed=(9301*this.randomSeed+49297)%233280,this.randomSeed/233280},t.prototype.randU=function(){return this.randomSeed=65539*this.randomSeed%2147483648,this.randomSeed/2147483648},t.prototype.randCLib=function(){return this.randomSeed=1103515245*this.randomSeed+12345,this.randomSeed=this.randomSeed/65536%32768,this.randomSeed/32767},t.prototype.randMSWin=function(){return this.randomSeed=214013*this.randomSeed+2531011,this.randomSeed=this.randomSeed/65536%32768,this.randomSeed/32767},t.prototype.randLCG=function(t,i,n){return this.randomSeed=(this.randomSeed*i+n)%t,this.randomSeed/t},t.prototype.randXorshift=function(){var t=2147483647&(this.x^this.x<<11);return this.x=this.y,this.y=this.z,this.z=this.randomSeed,this.randomSeed=this.randomSeed^this.randomSeed>>19^(t^t>>8),this.randomSeed/2147483648},t.prototype.randMersenne=function(){var t,i=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var n;for(n=0;n<this.N-this.M;n++)t=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK,this.mt[n]=this.mt[n+this.M]^t>>>1^i[1&t];for(;n<this.N-1;n++)t=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK,this.mt[n]=this.mt[n+(this.M-this.N)]^t>>>1^i[1&t];t=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^t>>>1^i[1&t],this.mti=0}return t=this.mt[this.mti++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,t^=t>>>18,(t>>>0)*(1/4294967295)},t}(),Delaunay;!function(){"use strict";function t(t){var i,n,s,e,r,a,h=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;for(i=t.length;i--;)t[i][0]<h&&(h=t[i][0]),t[i][0]>d&&(d=t[i][0]),t[i][1]<o&&(o=t[i][1]),t[i][1]>l&&(l=t[i][1]);return n=d-h,s=l-o,e=Math.max(n,s),r=h+.5*n,a=o+.5*s,[[r-20*e,a-e],[r,a+20*e],[r+20*e,a-e]]}function i(t,i,n,e){var r,a,h,o,d,l,c,u,m,p,f=t[i][0],g=t[i][1],S=t[n][0],y=t[n][1],k=t[e][0],v=t[e][1],x=Math.abs(g-y),P=Math.abs(y-v);if(s>x&&s>P)throw new Error("Eek! Coincident points!");return s>x?(o=-((k-S)/(v-y)),l=(S+k)/2,u=(y+v)/2,r=(S+f)/2,a=o*(r-l)+u):s>P?(h=-((S-f)/(y-g)),d=(f+S)/2,c=(g+y)/2,r=(k+S)/2,a=h*(r-d)+c):(h=-((S-f)/(y-g)),o=-((k-S)/(v-y)),d=(f+S)/2,l=(S+k)/2,c=(g+y)/2,u=(y+v)/2,r=(h*d-o*l+u-c)/(h-o),a=x>P?h*(r-d)+c:o*(r-l)+u),m=S-r,p=y-a,{i:i,j:n,k:e,x:r,y:a,r:m*m+p*p}}function n(t){var i,n,s,e,r,a;for(n=t.length;n;)for(e=t[--n],s=t[--n],i=n;i;)if(a=t[--i],r=t[--i],s===r&&e===a||s===a&&e===r){t.splice(n,2),t.splice(i,2);break}}var s=1/1048576;Delaunay={triangulate:function(e,r){var a,h,o,d,l,c,u,m,p,f,g,S,y=e.length;if(3>y)return[];if(e=e.slice(0),r)for(a=y;a--;)e[a]=e[a][r];for(o=new Array(y),a=y;a--;)o[a]=a;for(o.sort(function(t,i){return e[i][0]-e[t][0]}),d=t(e),e.push(d[0],d[1],d[2]),l=[i(e,y+0,y+1,y+2)],c=[],u=[],a=o.length;a--;u.length=0){for(S=o[a],h=l.length;h--;)m=e[S][0]-l[h].x,m>0&&m*m>l[h].r?(c.push(l[h]),l.splice(h,1)):(p=e[S][1]-l[h].y,m*m+p*p-l[h].r>s||(u.push(l[h].i,l[h].j,l[h].j,l[h].k,l[h].k,l[h].i),l.splice(h,1)));for(n(u),h=u.length;h;)g=u[--h],f=u[--h],l.push(i(e,f,g,S))}for(a=l.length;a--;)c.push(l[a]);for(l.length=0,a=c.length;a--;)c[a].i<y&&c[a].j<y&&c[a].k<y&&l.push(c[a].i,c[a].j,c[a].k);return l},contains:function(t,i){if(i[0]<t[0][0]&&i[0]<t[1][0]&&i[0]<t[2][0]||i[0]>t[0][0]&&i[0]>t[1][0]&&i[0]>t[2][0]||i[1]<t[0][1]&&i[1]<t[1][1]&&i[1]<t[2][1]||i[1]>t[0][1]&&i[1]>t[1][1]&&i[1]>t[2][1])return null;var n=t[1][0]-t[0][0],s=t[2][0]-t[0][0],e=t[1][1]-t[0][1],r=t[2][1]-t[0][1],a=n*r-s*e;if(0===a)return null;var h=(r*(i[0]-t[0][0])-s*(i[1]-t[0][1]))/a,o=(n*(i[1]-t[0][1])-e*(i[0]-t[0][0]))/a;return 0>h||0>o||h+o>1?null:[h,o]}},"undefined"!=typeof module&&(module.exports=Delaunay)}();var NameGeneratorElite=function(){function t(t){this.rng=t,this.pairs="..lexegezacebiso"}return t.prototype.randName=function(){var t=2*Math.floor(this.rng.rand()*(this.pairs.length/2)),i=2*Math.floor(this.rng.rand()*(this.pairs.length/2)),n=2*Math.floor(this.rng.rand()*(this.pairs.length/2)),s=2*Math.floor(this.rng.rand()*(this.pairs.length/2)),e="";return e+=this.pairs.substr(t,2),e+=this.pairs.substr(i,2),e+=this.pairs.substr(n,2),e+=this.pairs.substr(s,2),e=e.replace(/[.]/g,"")},t}(),__extends=this.__extends||function(t,i){function n(){this.constructor=t}for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s]);n.prototype=i.prototype,t.prototype=new n},Point=function(){function t(t,i){this.x=t,this.y=i}return t}(),Place=function(t){function i(n,s,e){t.call(this,n,s),this.id="place"+i.ID++,this.name=e,this.links=[],this.isVisited=!1}return __extends(i,t),i.prototype.addLink=function(t){for(var i=0;i<this.links.length;i++)if(this.links[i].id==t.id)return;this.links.push(t),t.links.push(this)},i.prototype.delLink=function(t){for(var i=0;i<this.links.length;i++)if(this.links[i].id==t.id)return this.links.splice(i,1),void t.delLink(this)},i.ID=0,i}(Point),Universe=function(){function t(t,i,n,s,e,r,a,h){void 0===a&&(a="uniform"),void 0===h&&(h=Date.now()),this.dimX=t,this.dimY=i,this.maxPlaces=n,this.margin=s,this.gap=e,this.gapSq=e*e,this.connectionLength=r,this.connectionLengthSq=r*r,this.distribution=a,this.seed=h,this.rngPlace=new SeededRNG(this.seed,"xorshift",this.distribution),this.rngName=new SeededRNG(this.seed,"xorshift","uniform"),this.nameGen=new NameGeneratorElite(this.rngName),this.generate()}return t.prototype.generate=function(){console.time("Generate"),this.rngPlace.reset(this.seed),this.rngName.reset(this.seed),Place.ID=0,this.places=[];for(var t=[],i=0,n=new Point(0,0);i<this.maxPlaces;)"gaussian"==this.distribution?(n.x=.5+(.5-this.margin)*this.rngPlace.randNorm()/3,n.y=.5+(.5-this.margin)*this.rngPlace.randNorm()/3):(n.x=this.margin+(1-2*this.margin)*this.rngPlace.rand(),n.y=this.margin+(1-2*this.margin)*this.rngPlace.rand()),this.isValidLocation(n)&&(this.places.push(new Place(n.x,n.y,this.nameGen.randName())),t.push([n.x,n.y]),i++);var s=Delaunay.triangulate(t);for(i=0;i<s.length;i+=3){var e=this.places[s[i+0]],r=this.places[s[i+1]],a=this.places[s[i+2]];e.addLink(r),e.addLink(a),r.addLink(a)}var h=this.places[0];h.links.sort(function(t,i){return distanceSq(h,i)-distanceSq(h,t)});for(var o=0;o>=h.links.length;o++){var d=h.links[o];distanceSq(h,d)>this.connectionLengthSq&&h.links.length>1&&(h.links.splice(o,1),o--)}for(i=1;i<this.places.length;i++){var l=this.places[i];l.links.sort(function(t,i){return distanceSq(l,i)-distanceSq(l,t)});for(var o=0;o<l.links.length;o++){var d=l.links[o];if(distanceSq(l,d)>this.connectionLengthSq){var c=l.links.slice(0),u=d.links.slice(0);l.delLink(d),o--,this.isPath(l,h)&&this.isPath(d,h)||(l.links=c,d.links=u,o++)}}}console.timeEnd("Generate")},t.prototype.generateOld=function(){console.time("GenerateOld1"),this.rngPlace.reset(this.seed),this.rngName.reset(this.seed),Place.ID=0,this.places=[];for(var t=[],i=0,n=new Point(0,0);i<this.maxPlaces;)"gaussian"==this.distribution?(n.x=.5+(.5-this.margin)*this.rngPlace.randNorm()/3,n.y=.5+(.5-this.margin)*this.rngPlace.randNorm()/3):(n.x=this.margin+(1-2*this.margin)*this.rngPlace.rand(),n.y=this.margin+(1-2*this.margin)*this.rngPlace.rand()),this.isValidLocation(n)&&(this.places.push(new Place(n.x,n.y,this.nameGen.randName())),t.push([n.x,n.y]),i++);var s=Delaunay.triangulate(t);for(i=0;i<s.length;i+=3){var e=this.places[s[i+0]],r=this.places[s[i+1]],a=this.places[s[i+2]];e.addLink(r),e.addLink(a),r.addLink(a)}for(i=0;i<this.places.length;i++)for(var h=this.places[i],o=0;o<h.links.length;o++){var d=h.links[o];distanceSq(h,d)>this.connectionLengthSq&&h.links.length>1&&d.links.length>1&&(h.delLink(d),o--)}console.timeEnd("GenerateOld1")},t.prototype.generateOld2=function(){console.time("GenerateOld2"),this.rngPlace.reset(this.seed),this.rngName.reset(this.seed),Place.ID=0,this.places=[];for(var t=[],i=0,n=new Point(0,0);i<this.maxPlaces;)"gaussian"==this.distribution?(n.x=.5+(.5-this.margin)*this.rngPlace.randNorm()/3,n.y=.5+(.5-this.margin)*this.rngPlace.randNorm()/3):(n.x=this.margin+(1-2*this.margin)*this.rngPlace.rand(),n.y=this.margin+(1-2*this.margin)*this.rngPlace.rand()),this.isValidLocation(n)&&(this.places.push(new Place(n.x,n.y,this.nameGen.randName())),t.push([n.x,n.y]),i++);var s=Delaunay.triangulate(t);for(i=0;i<s.length;i+=3){var e=this.places[s[i+0]],r=this.places[s[i+1]],a=this.places[s[i+2]];distanceSq(e,r)<this.connectionLengthSq&&e.links.push(r),distanceSq(e,a)<this.connectionLengthSq&&e.links.push(a),distanceSq(r,e)<this.connectionLengthSq&&r.links.push(e),distanceSq(r,a)<this.connectionLengthSq&&r.links.push(a),distanceSq(a,e)<this.connectionLengthSq&&a.links.push(e),distanceSq(a,r)<this.connectionLengthSq&&a.links.push(r)}console.timeEnd("GenerateOld2")},t.prototype.isValidLocation=function(t){if(!(t.x>this.margin&&t.x<1-this.margin&&t.y>this.margin&&t.y<1-this.margin))return!1;for(var i=0;i<this.places.length;i++){var n=this.places[i];if(distanceSq(t,n)<this.gapSq)return!1}return!0},t.prototype.getPlace=function(t){for(var i=0;i<this.places.length;i++){var n=this.places[i];if(n.id==t)return n}return null},t.prototype.isPath=function(t,i){for(var n=[],s=0;s<this.places.length;s++)this.places[s].isVisited=!1;for(n.push(t);n.length>0;){var e=n.pop();if(!e.isVisited){e.isVisited=!0;for(var s=0;s<e.links.length;s++){var r=e.links[s];if(r.id==i.id)return!0;n.push(r)}}}return!1},t}();